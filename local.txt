create database dbmeusservicos;
use dbmeusservicos;

create table tbusuarios(
iduser MEDIUMINT NOT NULL AUTO_INCREMENT Primary key,
usuario text not null,
cargo_usuario varchar(50),
telefone varchar(20) not null,
login varchar(50) not null unique,
senha varchar(50) not null,
perfil varchar(50) not  null,
comissao varchar(50)not null,
salario varchar(30),
valorVendidoUsuario varchar(80)
);

create table tbclientes(
idcli MEDIUMINT NOT NULL AUTO_INCREMENT Primary key,
nomecli text not null,
sexocli varcharacter(1),
cepcli varchar(15),
endcli text,
telefonecli varchar(20),
emailcli text,
quantidade_comprada int,
valor_gasto varchar(50),
ticket_medio varchar(50),
atividade varchar(50),
ultima_compra date,
prazo_inativo date,
crediario varchar(50)
);

select * from tbclientes;


create table tbsubclientes(
idsub MEDIUMINT NOT NULL AUTO_INCREMENT Primary key,
nome text not null,
endereco text,
genero varchar(20),
telefone varchar(30),
cep varchar(20),
email varchar(80),
especie_marca varchar(100),
raca_modelo varchar(80),
tamanho varchar(80),
cor varchar(80),
descricao varchar(80),
ano varchar(4),
referencia text,
obs text,
tipo varchar(80)
);

select * from tbsubclientes;

create table tbos(
os MEDIUMINT NOT NULL AUTO_INCREMENT Primary key,
data_os timestamp default current_timestamp,
tipo varchar(50) not null,
situacao varchar(50) not null,
previsao_entreg_os date,
equipamento text not null,
defeito text not null,
servico text,
funcionario varchar(30),
valor varchar(20),
cliente varchar(50)
);

select * from tbos;

create table tbvenda(
idvenda MEDIUMINT NOT NULL AUTO_INCREMENT Primary key,
nome text,
preco varchar(20),
quantidade int,
identificador int,
comissao varchar(80),
vendedor varchar(80),
comanda_nota text,
tipo varchar(80),
emicao timestamp,
porcentagem varchar(80),
cliente text,
subCliente text
);

alter table tbvenda add subCliente text;
select * from tbvenda;
select emicao,nome,quantidade,tipo,preco from tbvenda where cliente = "Vendas Sem Registro." order by emicao desc;

select nome, quantidade, comissao, vendedor, tipo, emicao, porcentagem from tbvenda where identificador = "";

create table  tbtotalvendas(
id  MEDIUMINT NOT NULL AUTO_INCREMENT Primary key,
dia date,
hora varchar(50),
venda varchar(20),
forma_pagamento varchar(50),
status_pagamento varchar(50),
dia_Pagamento date,
idcliente varchar(10),
cliente text,
tipo text,
identificador int,
comunicarVenda int
);

select * from tbtotalvendas order by identificador desc;

select cliente as Nome,
dia_Pagamento as Data_Pagamento,
forma_pagamento as Forma_de_Pagamento,
status_pagamento as Status_Pagamento,
venda as Valor_Ganho,	
tipo as Tipo from tbtotalvendas;

create table tbprodutos(
idproduto MEDIUMINT NOT NULL AUTO_INCREMENT Primary key,
codigo varchar(18),
produto text,
valor_compra varchar(12),
valor_venda varchar(12),
fornecedor text,
obs text,
estoque varchar(30),
quantidade int,
referencial_compra varchar(22),
referencial_venda varchar(22),
compra_x_venda varchar(22),
foto text
);

select * from tbprodutos;


create table tbcompra(
idcompra MEDIUMINT NOT NULL AUTO_INCREMENT Primary key,
nome_produto text,
valor varchar(20),
valor_unidade varchar(20),
quantidade_comprada int,
fornecedor varchar(50),
identificador text
);
alter table tbcompra add identificador text;
select * from tbcompra;

create table tbMaquininha(
id MEDIUMINT NOT NULL AUTO_INCREMENT Primary key,
nome  varchar(500) unique,
taxaDebito text,
taxaCredito text,
antecipacao text,
taxaAntecipacao text,
compensacaoDebito text,
compensacaoCredito text
);

select * from tbMaquininha;

create table tbgastos(
idgastos MEDIUMINT NOT NULL AUTO_INCREMENT Primary key,
valor varchar(20),
data_emissao date,
data_pagamento date,
nome text,
forma_pagamento varchar(50),
status_pagamento varchar(50),
tipo varchar(50),
comunicarGasto int,
identificador int
);

select idgastos,identificador from tbgastos;
alter table tbgastos add identificador int;
select * from tbgastos;

select * from(
select distinct E.identificador,E.nome,E.data_pagamento,E.valor, 
GROUP_CONCAT("",S.identificador,"\n") as VId,
GROUP_CONCAT("",IFNULL(S.nome_produto,"nulo"),"\n")as VNome, 
GROUP_CONCAT("Qtde: ",IFNULL(S.quantidade_comprada,"nulo"),"\n")as VQtde, 
GROUP_CONCAT("Preço R$ ",IFNULL(S.valor,"nulo"),"\n")as VPreco, 
GROUP_CONCAT("Cliente: ",IFNULL((S.fornecedor), "nulo"),"\n") as VCliente
from tbgastos E JOIN tbcompra S 
on  E.identificador = S.identificador
where E.status_pagamento="Pago" 
and E.data_pagamento  between $P{di} and $P{df} 
GROUP BY S.identificador)
id  order by 1 asc ;


create table tbfornecedor(
idfornecedor MEDIUMINT NOT NULL AUTO_INCREMENT Primary key,
nome_fornecedor text,
razaosocial text,
pessoa_juridica_fisica varchar(80),
cnpj varchar(80),
telefone_fornecedor varchar(20),
email_fornecedor varchar(80),
endereco text
);

create table tbrelatorio(
idRelatorio MEDIUMINT NOT NULL AUTO_INCREMENT Primary key,
nome_empresa text,
nome_proprietario text,
email_proprietario text,
descricao text,
numero text,
obs text,
imagem text,
taxaBoleto text,
tempoInativo text,
pix text
);

select * from tbrelatorio where idRelatorio=1;
insert into tbrelatorio(idRelatorio,nome_empresa,nome_proprietario,email_proprietario,descricao,numero,obs,imagem,taxaBoleto,tempoInativo,pix) values(1,"","","","","","","","","","");

create table tbservicos(
idservico MEDIUMINT NOT NULL AUTO_INCREMENT Primary key,
servico text,
id_cliente int,
id_C_referencia int,
data_agendada timestamp unique,
valor varchar(30),
obs text,
tipo varchar(80),
funcionario varchar(50),
cliente text,
subCliente text
);
alter table tbservicos add subCliente text;
alter table tbservicos drop nome ;
select * from tbservicos;

create table tbFuncionarios(
idFuncionario MEDIUMINT NOT NULL AUTO_INCREMENT Primary key,
funcionario varchar(100) unique,
salario varchar(50),
comissao varchar(10),
contrato date,
especialidade varchar(50),
validade_contrato varchar(50),
tipo varchar(50),
data_pagamento date,
valorVendido varchar(80)
);

create table tbVale(
idVale MEDIUMINT NOT NULL AUTO_INCREMENT Primary key,
senha varchar(80),
vencimento date
);

create table tbComanda(
idComanda MEDIUMINT NOT NULL AUTO_INCREMENT Primary key,
nomeComanda varchar(80)
);

select distinct tbtotalvendas.identificador,tbtotalvendas.cliente,tbtotalvendas.dia_pagamento,tbtotalvendas.venda,tbvenda.identificador,tbvenda.nome,tbvenda.quantidade,tbvenda.preco,tbvenda.tipo from (tbtotalvendas,tbvenda) where (tbvenda.identificador=tbtotalvendas.identificador);

select  distinct * from(
select distinct E.identificador,E.cliente,E.dia_pagamento,E.venda,E.forma_pagamento,
GROUP_CONCAT( distinctrow 
"\n\nID:", S.idvenda," - - - ",
"N°: ", S.identificador," - - - ",
"Nome: ",IFNULL(S.nome,"nulo")," - - - ",
"Qtde: ",IFNULL(S.quantidade,"nulo")," - - - ",
"Preço R$ ",IFNULL(S.preco,"nulo")," - - - "
"Tipo: ",IFNULL(S.tipo, "nulo")," - - - "
"Cliente: ",IFNULL((S.cliente), "nulo"),"") as VId
from  tbtotalvendas E LEFT JOIN  tbvenda S 
on   E.identificador = S.identificador 
where E.status_pagamento="Pago" 
and E.dia_pagamento  between "2023-07-01" and "2023-07-30" 
GROUP BY E.identificador
UNION 
select distinct E.identificador,E.cliente,E.dia_pagamento,E.venda,E.forma_pagamento, 
GROUP_CONCAT(distinctrow "",S.idvenda,"\n","",
S.identificador,"\n",
"",IFNULL(S.nome,"nulo"),
"\n","Qtde: ",IFNULL(S.quantidade,"nulo"),
"\n","Preço R$ ",IFNULL(S.preco,"nulo"),"\n"
"Tipo: ",IFNULL(S.tipo, "nulo"),"\n"
"Cliente: ",IFNULL((S.cliente), "nulo"),"\n") as VId
from   tbtotalvendas E RIGHT JOIN  tbvenda S  
on  E.identificador = S.identificador
where E.status_pagamento="Pago" 
and E.dia_pagamento  between "2023-07-01" and "2023-07-30" 
GROUP BY E.identificador)
id  order by 1 asc ;

select * from(
select distinct E.identificador,E.cliente,E.dia_pagamento,E.venda, 
GROUP_CONCAT("",S.identificador,"\n") as VId,
GROUP_CONCAT("",IFNULL(S.nome,"nulo"),"\n")as VNome, 
GROUP_CONCAT("Qtde: ",IFNULL(S.quantidade,"nulo"),"\n")as VQtde, 
GROUP_CONCAT("Preço R$ ",IFNULL(S.preco,"nulo"),"\n")as VPreco, 
GROUP_CONCAT("Tipo: ",IFNULL(S.tipo, "nulo"),"\n")as VTipo, 
GROUP_CONCAT("Cliente: ",IFNULL((S.cliente), "nulo"),"\n") as VCliente
from tbtotalvendas E JOIN tbvenda S 
on  .identificador = S.identificador
where E.status_pagamento="Pago" 
and E.dia_pagamento  between $P{di} and $P{df} 
GROUP BY S.identificador)
id  order by 1 asc ;

select * from(
select E.id,E.cliente,E.venda,E.tipo,S.idgastos,S.nome,S.valor,S.tipo as tipoS 
from tbtotalvendas E left join tbgastos S
on comunicarVenda = comunicarGasto and S.status_pagamento="Pago"  
and data_pagamento between $P{di} and $P{df}
where E.status_pagamento="Pago" 
and dia between $P{di} and $P{df} 
union select E.id,E.cliente,E.venda,E.tipo,S.idgastos,S.nome,S.valor,S.tipo as tipoS 
from tbtotalvendas E right outer join tbgastos S
on S.comunicarGasto = E.comunicarVenda 
and E.status_pagamento='Pago' 
and dia between $P{di} and $P{df}
where S.status_pagamento="Pago" 
and data_pagamento between $P{di} and $P{df})
 idgastos  order by 1 asc;

insert into tbusuarios(iduser,usuario,cargo_usuario,telefone,login,senha,perfil,comissao) values(1,'Administrador','Administrador','000000000000000','admin','admin123','Administrador','0%');
insert into tbprodutos(produto,valor_compra,valor_venda,fornecedor,estoque,quantidade) values('teste','20.00','100.00','Selecione','Com controle de estoque.','1');

insert into tbclientes(nomecli,quantidade_comprada,valor_gasto,ticket_medio,crediario,endcli) values('Vendas Sem Registro.','0.00','0.00','0.00','Habilitado','');
insert into tbVale(idVale) values(1);

select * from tbvale;
select * from tbcompra;
select * from tbprodutos;
select * from tbrelatorio;
